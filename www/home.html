<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/custom.css">
    <link rel="stylesheet" href="assets/css/custom.css">

   
    <title>Añadir un producto</title>
</head>
<body>
    
      
      
    <nav class="navbar navbar-inverse navbar-fixed-top">
        
    </nav>
    <div class="container-fluid mt-2">
    <h4>Alta de ususarios </h4>
        <form id="formularioAlta" class="mt-2">
            <div class="form-group">
                <label for="nombre">Nombre</label>
                <input type="text" class="form-control" name="nombre" id="nombre" placeholder="Nombre">
            </div>
            <div class="form-group">
                <label for="email">Correo</label>
                <input  type="email" class="form-control" name="email" id="email" placeholder="Email" rows="3"></input>
            </div>
            <div class="form-group">
                <label for="edad">Edad</label>
                <input type="text" class="form-control" name="edad" id="edad" placeholder="Edad">
            </div>
            <select class="form-select" name="sexo" id="sexo" aria-label="Default select example">
                <option selected>Sexo</option>
                <option value="H">H</option>
                <option value="M">M</option>
                <option value="X">X</option>
            </select>
            <div class="form-group">
                <label for="ciudad">Ciudad</label>
                <input type="text" class="form-control" name="ciudad" id="ciudad" placeholder="ciudad">
            </div>
            <div class="form-group mt-2">
                <label for="imgInp">Elegir Imagen</label>
                <input type="file" name="imgInp" id="imgInp"><br>
                <img id="imagen" width="100px" src="#">
            </div>
            <div class="form-check form-check-inline">
                <input class="" type="checkbox" id="aficion1" value="option1">
                <label class="form-check-label" for="aficion1">Cine</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="" type="checkbox" id="aficion2" value="option2">
                <label class="form-check-label" for="aficion2">Pasear</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="" type="checkbox" id="aficion3" value="option3">
                <label class="form-check-label" for="aficion3">Bailar</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="" type="checkbox" id="aficion4" value="option3">
                <label class="form-check-label" for="aficion4">Viajar</label>
              </div>
              <div><button type="button" id="botonGuardar" class="btn btn-primary mt-3">Guardar</button></div>
             
        </form>
    </div>
    

   
    



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
   
    <script  src="assets/js/sendNotifye.js"></script>
    <script src="assets/alerts/js/iziToast.min.js"></script>
    <script type="module">
        
        // Inicializar Supabase
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        const supabaseUrl = "https://srcawgqnbyyzhbqpznpd.supabase.co"; // Reemplaza con tu URL de Supabase
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNyY2F3Z3FuYnl5emhicXB6bnBkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM1NDEzODMsImV4cCI6MjA1OTExNzM4M30.DI8Ab7zicxcIo56rdrO6UE0T_zZ7TmHNFZe4a4Z7w-0"; 
        const BUCKET_NAME = "imagenes"; // Nombre del bucket en Supabase
        const supabase = createClient(supabaseUrl, supabaseKey);

        async function guardarUsuario() {
            const nombre = document.getElementById("nombre").value;
            const edad = document.getElementById("edad").value;
            const email = document.getElementById("email").value;
            const sexo = document.getElementById("sexo").value;
            const ciudad = document.getElementById("ciudad").value;
            const imagen = document.getElementById("imgInp").files[0];
        console.log(nombre+"  "+edad+"  "+email+"  "+imagen )
            if (nombre && edad && email && imagen && sexo && ciudad) {
                try {
                    {
                        const filePath = `imagenes/${Date.now()}_${imagen.name}`; // Usa la variable `imagen`

                    // Subir la imagen al bucket de Supabase
                    const { data, error } = await supabase.storage.from(BUCKET_NAME).upload(filePath, file);

                    if (error) {
                        console.error("Error al subir la imagen:", error);
                        alert("Error al subir la imagen.");
                        return;
                    }

                     // Obtener la URL pública de la imagen
                    const { data: publicURL } = supabase.storage.from(BUCKET_NAME).getPublicUrl(filePath);

                    // Guardar los datos del usuario en la base de datos
                    const { data: userData, error: userError } = await supabase
                        .from("usuarios") // Asegúrate de tener una tabla llamada "usuarios"
                        .insert([
                            {
                                nombre: nombre,
                                edad: parseInt(edad),
                                email: email,
                                sexo: sexo,
                                ciudad: ciudad,
                                imagen: imagenUrl,
                            },
                        ]);

                    if (userError) {
                        throw userError;
                    }

                    alert("Usuario guardado correctamente");
                    cargarUsuarios(); // Implementa esta función si necesitas recargar la lista de usuarios
                } catch (error) {
                    console.error("Error al guardar el usuario:", error.message);
                    alert("Hubo un error al guardar el usuario.");
                }
            } else {
                alert("Por favor, llena todos los campos y selecciona una imagen.");
            }
        }

        // Asociar el evento al botón
        document.getElementById("botonGuardar").addEventListener("click", guardarUsuario);
</script>
       

    
    <script type="module" src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js"></script>
<script type="module" src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js"></script>
   </body>
</html>